name: CI

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test_single:
    name: ${{ matrix.vim_name }}
    strategy:
      fail-fast: false
      matrix:
        include:
          - vim_name: neovim-v0.5.0
            install_vim_args: -tag neovim:v0.5.0 -py3
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Build example for test
        run: |
          printf 'FROM vim-testbed-base\nRUN install_vim %s -build\n' '${{ matrix.install_vim_args }}' > example/Dockerfile.tests
          make build_example_for_test
      - run: make -C example test_vims_basic_test

  test_full:
    needs: test_single
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - run: make build_example_for_test
      - run: make --keep-going test_example
